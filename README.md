# –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä 2.0

> –°–µ—Ä–≤–∏—Å –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å—Ä–µ–¥–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- `cmd/orchestrator` ‚Äî HTTP –∏ gRPC —Å–µ—Ä–≤–∏—Å (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
- `cmd/worker` ‚Äî gRPC –∫–ª–∏–µ–Ω—Ç (Worker), –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
- `internal/repository` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å SQLite (–º–æ–¥–µ–ª–∏, –º–∏–≥—Ä–∞—Ü–∏–∏, CRUD)
- `internal/orchestrator` ‚Äî –ª–æ–≥–∏–∫–∞ HTTP-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –ø–∞—Ä—Å–µ—Ä –≤—ã—Ä–∞–∂–µ–Ω–∏–π, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á, gRPC —Å–µ—Ä–≤–µ—Ä
- `internal/worker` ‚Äî gRPC-–≤–æ—Ä–∫–µ—Ä, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
- `pkg/grpc/calculator` ‚Äî protobuf-–æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.23 –∏–ª–∏ –≤—ã—à–µ
- SQLite3
- protoc + protoc-gen-go (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏ `.proto`)
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) `jq` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è JSON –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö
- make

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git clone https://github.com/atadzan/dist-arith-go.git
   cd dist-arith-go
   ```

2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   go mod tidy
   ```

3. –ó–∞–ø—É—Å–∫–∞–µ–º –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä:
   ```bash
   make run-orchestrator
   ```

4. –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å–∫–∞–µ–º worker (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤):
   ```bash
   make run-worker
   ```

## üì° API HTTP (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)

–ë–∞–∑–æ–≤—ã–π URL: `http://localhost:8080/api/v1`

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- **POST** `/register`
  ```bash
  curl -s -X POST http://localhost:8080/api/v1/register \
    -H "Content-Type: application/json" \
    -d '{"login":"user1","password":"pass123"}'
  ```

- **–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞**:
  - `200 OK` ‚Äî —É—Å–ø–µ—à–Ω–æ
  - `400 Bad Request` ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–ª–∏ –ø—É—Å—Ç—ã–µ –ø–æ–ª—è
  - `409 Conflict` ‚Äî –ª–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç

### 2. –í—Ö–æ–¥ (JWT)

- **POST** `/login`
  ```bash
  curl -s -X POST http://localhost:8080/api/v1/login \
    -H "Content-Type: application/json" \
    -d '{"login":"user1","password":"pass123"}'
  ```

- **–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞**:
  - `200 OK` –∏ JSON:
    ```json
    { "token": "<JWT_TOKEN>" }
    ```
  - `400 Bad Request` ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
  - `401 Unauthorized` ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–µ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ

- **POST** `/calculate`
  ```bash
  curl -s -X POST http://localhost:8080/api/v1/calculate \
    -H "Content-Type: application/json" \
    -H "Authorization: Bearer <JWT_TOKEN>" \
    -d '{"expression":"(2+3)*4"}'
  ```

- **–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞**:
  - `201 Created` –∏ JSON:
    ```json
    {
      "id": 1,
      "expression": "(2+3)*4",
      "status": "pending"
    }
    ```
  - `400 Bad Request` ‚Äî –ø—É—Å—Ç–æ–µ –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
  - `401 Unauthorized` ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

- **GET** `/expressions` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–∞—à–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
- **GET** `/expressions/<id>` ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ø–æ ID

```bash
curl -s -X GET http://localhost:8080/api/v1/expressions/<id> \
  -H "Authorization: Bearer <JWT_TOKEN>"
```

- **–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞**:
  - `200 OK` –∏ JSON-–æ–±—ä–µ–∫—Ç/–º–∞—Å—Å–∏–≤:
    ```json
    [
      {
        "id": 1,
        "user_id": 1,
        "expression": "(2+3)*4",
        "status": "done",
        "result": 20,
        "steps": ["Result: 5","Result: 20"],
        "created_at": "...",
        "updated_at": "..."
      }
    ]
    ```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:
  ```bash
  go test ./...
  ```

- –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã:
  ```bash
  go test ./internal/orchestrator/parser.go
  go test ./internal/worker/worker.go
  go test ./internal/repository
  ```

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:
  ```bash
  go test ./internal/orchestrator
  go test ./internal/orchestrator/grpc_server_test.go
  ```

## üîß –ì–µ–Ω–µ—Ä–∞—Ü–∏—è protobuf

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –∏–∑ `.proto`:

```bash
make generate-proto
```
---